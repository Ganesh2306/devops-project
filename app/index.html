<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Duck Hunt â€“ Stable Version</title>

<style>
/* ==== SAME CSS (UNCHANGED) ==== */
* {
    user-select: none;
    -webkit-tap-highlight-color: transparent;
}
body {
    margin: 0;
    height: 100vh;
    overflow: hidden;
    background: #333;
}
#game-container {
    position: fixed;
    width: 100%;
    height: 100%;
    background: linear-gradient(to bottom, #87CEEB, #1E90FF);
}
#scope {
    position: absolute;
    width: 150px;
    height: 150px;
    border: 2px solid red;
    border-radius: 50%;
    pointer-events: none;
    transform: translate(-50%, -50%);
}
#scope::before,#scope::after{
    content:'';
    position:absolute;
    background:red;
}
#scope::before{width:100%;height:2px;top:50%;}
#scope::after{height:100%;width:2px;left:50%;}
.duck{position:absolute}
.duck-body{width:50px;height:35px;background:#007755;border-radius:50%}
.duck-wing{width:25px;height:15px;background:#005544;border-radius:50%;animation:flap 0.3s infinite alternate}
@keyframes flap{from{transform:rotate(-20deg)}to{transform:rotate(20deg)}}
#hud,#ammo,#wind-indicator{
    position:absolute;
    background:rgba(0,0,0,.7);
    color:#fff;
    padding:10px;
    border-radius:6px;
    font-family:monospace;
}
#hud{bottom:15px;left:15px}
#ammo{bottom:15px;right:15px}
#wind-indicator{top:15px;left:50%;transform:translateX(-50%)}
#game-over{
    display:none;
    position:absolute;
    top:50%;left:50%;
    transform:translate(-50%,-50%);
    background:rgba(0,0,0,.9);
    color:#fff;
    padding:20px;
    border-radius:10px;
    text-align:center;
}
.bullet-hole{width:8px;height:8px;background:black;border-radius:50%;position:absolute}
.feathers{width:80px;height:80px;background:white;opacity:.8;position:absolute}
.points-popup{color:gold;font-weight:bold;position:absolute}
</style>
</head>

<body>
<div id="game-container">
    <div id="scope"></div>

    <div id="wind-indicator">
        WIND: <span id="wind-value">0</span>
    </div>

    <div id="hud">
        SCORE: <span id="score">0</span><br>
        DUCKS: <span id="ducks-left">10</span>
    </div>

    <div id="ammo">
        AMMO: <span id="ammo-count">5</span>/5
    </div>

    <div id="game-over">
        <h2>MISSION COMPLETE</h2>
        SCORE: <span id="final-score">0</span><br><br>
        <button onclick="initGame()">NEW HUNT</button>
    </div>
</div>

<!-- AUDIO -->
<audio id="gunshot" src="https://textronicsbucket.s3.ap-south-1.amazonaws.com/audio_file/gun-shot-359196.mp3"></audio>
<audio id="reload" src="https://textronicsbucket.s3.ap-south-1.amazonaws.com/audio_file/reload-123781.mp3"></audio>
<audio id="hit" src="https://textronicsbucket.s3.ap-south-1.amazonaws.com/audio_file/duck-hit.mp3"></audio>

<script>
/* ================= FIXED JS ================= */

// ELEMENTS
const game = document.getElementById("game-container");
const scope = document.getElementById("scope");
const scoreEl = document.getElementById("score");
const ducksEl = document.getElementById("ducks-left");
const ammoEl = document.getElementById("ammo-count");
const gameOverEl = document.getElementById("game-over");
const finalScoreEl = document.getElementById("final-score");
const windValue = document.getElementById("wind-value");

// AUDIO SAFE PLAY
function safePlay(a){ a.currentTime=0; a.play().catch(()=>{}); }

// GAME STATE
let score, ducksLeft, ammo, gameRunning;
let ducks = [];
let windSpeed = 0;

// INTERVAL HOLDERS (FIX)
let windInterval = null;
let spawnInterval = null;

// INIT
function initGame(){
    // CLEAR OLD INTERVALS
    if(windInterval) clearInterval(windInterval);
    if(spawnInterval) clearInterval(spawnInterval);

    // RESET
    score = 0;
    ducksLeft = 10;
    ammo = 5;
    gameRunning = true;
    ducks = [];

    scoreEl.textContent = score;
    ducksEl.textContent = ducksLeft;
    ammoEl.textContent = ammo;
    gameOverEl.style.display = "none";

    document.querySelectorAll(".duck,.bullet-hole,.feathers,.points-popup")
        .forEach(e=>e.remove());

    updateWind();
    windInterval = setInterval(updateWind,10000);
    spawnInterval = setInterval(()=>{
        if(gameRunning && ducks.length<4 && ducksLeft>0) spawnDuck();
    },3000);

    spawnDuck();
    spawnDuck();
}

// WIND
function updateWind(){
    windSpeed = Math.random()*10;
    windValue.textContent = windSpeed.toFixed(1)+" m/s";
}

// SPAWN DUCK
function spawnDuck(){
    if(!gameRunning || ducksLeft<=0) return;

    ducksLeft--;
    ducksEl.textContent = ducksLeft;

    const duck = document.createElement("div");
    duck.className = "duck";
    duck.innerHTML = `<div class="duck-body"></div><div class="duck-wing"></div>`;
    duck.style.top = Math.random()*300+50+"px";
    duck.style.left = "-60px";
    game.appendChild(duck);

    let x = -60;
    const speed = 2 + Math.random()*2;

    function fly(){
        if(!gameRunning || !duck.isConnected) return;
        x += speed;
        duck.style.left = x+"px";

        if(x > window.innerWidth+100){
            duck.remove();
            ducks = ducks.filter(d=>d!==duck);
            if(ducksLeft===0 && ducks.length===0) endGame();
            return;
        }
        requestAnimationFrame(fly);
    }

    ducks.push(duck);
    fly();
}

// SHOOT (FIX: ONE DUCK ONLY)
function shoot(x,y){
    if(!gameRunning || ammo<=0) return;

    ammo--;
    ammoEl.textContent = ammo;
    safePlay(document.getElementById("gunshot"));

    const hole=document.createElement("div");
    hole.className="bullet-hole";
    hole.style.left=x+"px";
    hole.style.top=y+"px";
    game.appendChild(hole);
    setTimeout(()=>hole.remove(),2000);

    for(let i=0;i<ducks.length;i++){
        const d=ducks[i];
        const r=d.getBoundingClientRect();
        const dx=x-(r.left+r.width/2);
        const dy=y-(r.top+r.height/2);
        if(Math.sqrt(dx*dx+dy*dy)<30){
            score+=100;
            scoreEl.textContent=score;
            safePlay(document.getElementById("hit"));
            d.remove();
            ducks.splice(i,1);
            break; // IMPORTANT FIX
        }
    }

    if(ammo===0) setTimeout(reload,800);
}

// RELOAD
function reload(){
    ammo=5;
    ammoEl.textContent=ammo;
    safePlay(document.getElementById("reload"));
}

// END GAME
function endGame(){
    gameRunning=false;
    finalScoreEl.textContent=score;
    gameOverEl.style.display="block";
}

// CONTROLS
game.addEventListener("mousemove",e=>{
    scope.style.left=e.clientX+"px";
    scope.style.top=e.clientY+"px";
});
game.addEventListener("click",e=>shoot(e.clientX,e.clientY));
document.addEventListener("keydown",e=>{
    if(e.key==="r") reload();
});

// START
initGame();
</script>
</body>
</html>
